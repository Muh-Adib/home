; PHP Configuration for Dokploy Production
; Property Management System - Optimized Settings

; Memory & Performance
memory_limit = 256M
max_execution_time = 300
max_input_time = 300
post_max_size = 50M
upload_max_filesize = 50M
max_file_uploads = 20

; Session Configuration
session.gc_maxlifetime = 7200
session.cookie_lifetime = 0
session.cookie_httponly = 1
session.cookie_secure = 1
session.use_strict_mode = 1
session.cookie_samesite = "Lax"
session.name = "homsjogja_session"

; Error Reporting (Production)
display_errors = Off
display_startup_errors = Off
log_errors = On
error_log = /var/log/php_errors.log
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT

; OPcache Configuration (Highly optimized)
opcache.enable = 1
opcache.enable_cli = 1
opcache.memory_consumption = 128
opcache.interned_strings_buffer = 8
opcache.max_accelerated_files = 4000
opcache.revalidate_freq = 60
opcache.fast_shutdown = 1
opcache.validate_timestamps = 0
opcache.save_comments = 1
opcache.load_comments = 1
opcache.enable_file_override = 1

; Realpath Cache (Performance boost)
realpath_cache_size = 4096K
realpath_cache_ttl = 600

; File uploads
file_uploads = On

; Date/Time
date.timezone = Asia/Jakarta

; Output buffering
output_buffering = 4096
output_handler = ""

; Resource limits
max_input_vars = 3000
max_input_nesting_level = 64

; Process control
process_control_timeout = 30

; FastCGI settings
fastcgi.read_timeout = 300

; MySQL PDO
pdo_mysql.default_socket = /var/run/mysqld/mysqld.sock

; Security
expose_php = Off
allow_url_fopen = On
allow_url_include = Off

; Logging
log_errors_max_len = 1024
ignore_repeated_errors = On
ignore_repeated_source = Off

; Variables order
variables_order = "GPCS"
request_order = "GP"

; Auto globals
auto_globals_jit = On

; PHP-FPM specific settings
[www]
user = www
group = www
listen = 127.0.0.1:9000
listen.owner = www
listen.group = www
listen.mode = 0660

pm = dynamic
pm.max_children = 20
pm.start_servers = 4
pm.min_spare_servers = 2
pm.max_spare_servers = 6
pm.max_requests = 1000

; Ping/Status pages
ping.path = /ping
ping.response = pong
pm.status_path = /status

; Slow log
slowlog = /var/log/php-fpm-slow.log
request_slowlog_timeout = 10s

; Security
security.limit_extensions = .php

; Environment variables
clear_env = no